<!-- table.component.html - VERSIÓN LIMPIA SIN ERRORES -->
<div class="w-full">
  <!-- Header -->
  <div *ngIf="title || subtitle || config.filtering?.globalSearch"
    class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
    <!-- Títulos -->
    <div class="flex-1">
      <h3 *ngIf="title" class="text-xl font-bold text-gray-800">{{ title }}</h3>
      <p *ngIf="subtitle" class="text-gray-600 mt-1">{{ subtitle }}</p>
    </div>

    <!-- Búsqueda global -->
    <div *ngIf="config.filtering?.globalSearch" class="relative">
      <div class="tbl-search-icon">
        <i class="fas fa-search"></i>
      </div>
      <input type="text" placeholder="Buscar empleado..." [(ngModel)]="globalSearch" (input)="onGlobalSearch()"
        class="tbl-search" />
    </div>
  </div>

  <!-- Tabla Container -->
  <div class="tbl-card" data-role="table-card">
    <!-- Loading Overlay -->
    <div *ngIf="loading" class="relative">
      <div class="absolute inset-0 bg-white bg-opacity-95 z-10 flex items-center justify-center">
        <div class="flex items-center gap-3 bg-white rounded-2xl px-6 py-4 shadow-lg border">
          <div class="animate-spin rounded-full h-6 w-6 border-2 border-iebem-light border-t-iebem-primary"></div>
          <span class="text-sm text-iebem-dark font-medium">Cargando empleados...</span>
        </div>
      </div>
    </div>

    <!-- Vista Desktop (md y superiores) -->
    <div class="hidden md:block">
      <div class="tbl-scroll" data-role="table-scroll">
        <table class="tbl" data-role="table">
          <!-- Header Desktop -->
          <thead class="tbl-head" [ngClass]="{
              'tbl-head--sticky': config.stickyHeader,
              'tbl-head--glass': config.headerStyle==='glass',
              'tbl-head--primary': config.headerStyle==='primary',
              'tbl-head--gradient': config.headerStyle==='gradient',
              'tbl-head--soft': config.headerStyle==='soft'
            }">
            <tr>
              <!-- Columnas visibles en desktop -->
              <th *ngFor="let column of getDesktopColumns(); trackBy: trackByColumn"
                class="tbl-th"
                [ngClass]="{
                  'tbl-th--compact': config.compact,
                  'tbl-th--glass': config.headerStyle==='glass',
                  'tbl-th--primary': config.headerStyle==='primary',
                  'tbl-th--gradient': config.headerStyle==='gradient',
                  'tbl-th--soft': config.headerStyle==='soft'
                }"
                [style.min-width]="getResponsiveWidth(column)">
                <div class="tbl-th-label">
                  <span class="truncate">{{ column.title }}</span>
                  <!-- Sort button -->
                  <button *ngIf="column.sortable && config.sorting?.enabled" (click)="onSort(column.key)"
                    class="tbl-sort-btn"
                    [ngClass]="{
                      'tbl-sort-btn--glass': config.headerStyle==='glass',
                      'tbl-sort-btn--primary': config.headerStyle==='primary',
                      'tbl-sort-btn--gradient': config.headerStyle==='gradient',
                      'tbl-sort-btn--soft': config.headerStyle==='soft'
                    }"
                    [attr.aria-sort]="sortColumn===column.key ? (sortDirection==='asc' ? 'ascending' : 'descending') : 'none'">
                    <i [class]="getSortIcon(column.key)"></i>
                  </button>
                </div>
              </th>

              <!-- Columna de acciones -->
              <th *ngIf="actions.length > 0"
                class="tbl-th text-center w-32"
                [ngClass]="{
                  'tbl-th--glass': config.headerStyle==='glass',
                  'tbl-th--primary': config.headerStyle==='primary',
                  'tbl-th--gradient': config.headerStyle==='gradient',
                  'tbl-th--soft': config.headerStyle==='soft'
                }">
                <i class="fas fa-cogs mr-1"></i>
                Acciones
              </th>
            </tr>
          </thead>

          <!-- Body Desktop -->
          <tbody class="tbl-body">
            <!-- Empty state -->
            <tr *ngIf="processedData.length === 0 && !loading">
              <td [attr.colspan]="getDesktopColumns().length + (actions.length > 0 ? 1 : 0)"
                class="tbl-empty">
                <div class="flex flex-col items-center">
                  <div
                    class="w-20 h-20 bg-gradient-to-br from-iebem-primary to-iebem-secondary rounded-2xl flex items-center justify-center mb-6 shadow-lg">
                    <i class="fas fa-users text-white text-3xl"></i>
                  </div>
                  <h3 class="text-xl font-bold text-iebem-dark mb-3">{{ emptyMessage }}</h3>
                  <p class="text-gray-500 text-sm">Agrega tu primer empleado para comenzar</p>
                </div>
              </td>
            </tr>

            <!-- Data rows Desktop -->
            <tr *ngFor="let row of processedData; trackBy: trackByRow; let i = index"
              class="tbl-row tbl-row--clickable group"
              [ngClass]="{'tbl-row--hover': config.hoverable, 'odd:bg-gray-50': config.striped}"
              (click)="onRowClick(row)">

              <!-- Data cells Desktop -->
              <td *ngFor="let column of getDesktopColumns(); trackBy: trackByColumn" class="tbl-td"
                  [ngClass]="{'tbl-td--compact': config.compact, 'tbl-td--bordered': config.bordered}">

                <!-- NUEVO: si la columna trae plantilla, úsala -->
                <ng-container *ngIf="column.template || column.cellTemplate; else defaultCell" [ngTemplateOutlet]="(column.template || column.cellTemplate) ?? null"
                  [ngTemplateOutletContext]="{
                  $implicit: getColumnValue(row, column.key),
                  row: row,
                  col: column
                }">
                </ng-container>

                <!-- Comportamiento por defecto (lo que ya tenías) -->
                <ng-template #defaultCell>
                  <div [ngSwitch]="column.type">
                    <!-- Text -->
                    <div *ngSwitchCase="'text'">
                      <span
                        class="text-iebem-dark font-medium group-hover:text-iebem-primary transition-colors truncate">
                        {{ formatCellValue(getColumnValue(row, column.key), column) }}
                      </span>
                    </div>

                    <!-- Number -->
                    <div *ngSwitchCase="'number'" class="text-right">
                      <span class="font-mono text-iebem-dark bg-iebem-light px-3 py-1 rounded-lg text-xs">
                        {{ formatCellValue(getColumnValue(row, column.key), column) }}
                      </span>
                    </div>

                    <!-- Date -->
                    <div *ngSwitchCase="'date'">
                      <span class="text-gray-700">
                        {{ formatCellValue(getColumnValue(row, column.key), column) }}
                      </span>
                    </div>

                    <!-- Badge -->
                    <div *ngSwitchCase="'badge'">
                      <span
                        class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-iebem-light text-iebem-dark">
                        {{ formatCellValue(getColumnValue(row, column.key), column) }}
                      </span>
                    </div>

                    <!-- Boolean -->
                    <div *ngSwitchCase="'boolean'">
                      <span [class]="getBooleanBadgeClasses(getColumnValue(row, column.key))">
                        {{ formatCellValue(getColumnValue(row, column.key), column) }}
                      </span>
                    </div>

                    <!-- Default -->
                    <div *ngSwitchDefault>
                      <span class="text-gray-700">{{ formatCellValue(getColumnValue(row, column.key), column) }}</span>
                    </div>
                  </div>
                </ng-template>
              </td>


              <!-- Actions cell Desktop -->
              <td *ngIf="actions.length > 0" class="tbl-td text-center">
                <div class="flex justify-center gap-2">
                  <button *ngFor="let action of actions" (click)="onAction(action, row, $event)"
                    [class]="getActionBtnClasses(action)" [title]="action.label">
                    <i *ngIf="action.icon" [class]="'fas fa-' + action.icon + ' text-xs'"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Vista Mobile (sm y menores) -->
    <div class="md:hidden">
      <!-- Empty state Mobile -->
      <div *ngIf="processedData.length === 0 && !loading" class="px-6 py-20 text-center">
        <div class="flex flex-col items-center">
          <div
            class="w-20 h-20 bg-gradient-to-br from-iebem-primary to-iebem-secondary rounded-2xl flex items-center justify-center mb-6 shadow-lg">
            <i class="fas fa-users text-white text-3xl"></i>
          </div>
          <h3 class="text-xl font-bold text-iebem-dark mb-3">{{ emptyMessage }}</h3>
          <p class="text-gray-500 text-sm">Agrega tu primer empleado para comenzar</p>
        </div>
      </div>

      <!-- Cards Mobile -->
      <div class="divide-y divide-gray-100">
        <div *ngFor="let row of processedData; trackBy: trackByRow"
          class="tbl-mobile-card"
          data-role="table-mobile-card"
          [ngClass]="{'tbl-mobile-card--compact': config.compact, 'tbl-mobile-card--bordered': config.bordered}"
          (click)="onRowClick(row)">

          <!-- Card Header -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1 min-w-0">
              <h3 class="text-lg font-bold text-iebem-dark truncate">
                {{ getColumnValue(row, 'firstName') }} {{ getColumnValue(row, 'lastName') }}
              </h3>
              <p class="text-sm text-gray-600 truncate">{{ getColumnValue(row, 'email') }}</p>
            </div>

            <!-- Estado -->
            <div class="ml-3">
              <span [class]="getModernBadgeClasses(getColumnValue(row, 'status'))">
                <span class="w-2 h-2 rounded-full bg-current mr-1"></span>
                <span class="text-xs font-bold">{{ getColumnValue(row, 'status') | titlecase }}</span>
              </span>
            </div>
          </div>

          <!-- Card Body -->
          <div class="grid grid-cols-2 gap-3 mb-3">
            <div class="bg-iebem-light bg-opacity-30 rounded-lg p-3">
              <div class="flex items-center">
                <i class="fas fa-briefcase text-iebem-primary mr-2"></i>
                <div class="min-w-0 flex-1">
                  <p class="text-xs text-gray-600">Puesto</p>
                  <p class="font-medium text-iebem-dark truncate text-sm">{{ getColumnValue(row, 'position') }}</p>
                </div>
              </div>
            </div>

            <div class="bg-iebem-secondary bg-opacity-10 rounded-lg p-3">
              <div class="flex items-center">
                <i class="fas fa-building text-iebem-secondary mr-2"></i>
                <div class="min-w-0 flex-1">
                  <p class="text-xs text-gray-600">Departamento</p>
                  <p class="font-medium text-iebem-dark truncate text-sm">{{ getColumnValue(row, 'department') }}</p>
                </div>
              </div>
            </div>

            <div class="bg-info bg-opacity-10 rounded-lg p-3">
              <div class="flex items-center">
                <i class="fas fa-phone text-info mr-2"></i>
                <div class="min-w-0 flex-1">
                  <p class="text-xs text-gray-600">Teléfono</p>
                  <p class="font-medium text-iebem-dark text-sm">{{ getColumnValue(row, 'phone') }}</p>
                </div>
              </div>
            </div>

            <div class="bg-success bg-opacity-10 rounded-lg p-3">
              <div class="flex items-center">
                <i class="fas fa-dollar-sign text-success mr-2"></i>
                <div class="min-w-0 flex-1">
                  <p class="text-xs text-gray-600">Salario</p>
                  <p class="font-medium text-iebem-dark text-sm">{{ formatMobileValue(getColumnValue(row, 'salary'),
                    'currency') }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div *ngIf="actions.length > 0" class="flex justify-end gap-2 pt-3 border-t border-gray-200">
            <button *ngFor="let action of actions" (click)="onAction(action, row, $event)"
              [class]="getActionBtnClasses(action)" [title]="action.label">
              <i *ngIf="action.icon" [class]="'fas fa-' + action.icon + ' text-xs'"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer con paginación -->
    <div *ngIf="config.pagination?.enabled && totalItems > 0" class="px-6 py-4 bg-gray-50 border-t border-gray-200">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <!-- Info de resultados -->
        <div class="text-sm font-medium text-center sm:text-left text-gray-700">
          <span class="text-iebem-primary font-bold">{{ getStartRecord() }} - {{ getEndRecord() }}</span>
          <span class="mx-1">de</span>
          <span class="text-iebem-primary font-bold">{{ totalItems }}</span>
          <span>empleados</span>
        </div>

        <!-- Controles de paginación -->
        <div class="pager">
          <!-- Primera página -->
          <button (click)="onPageChange(1)" [disabled]="currentPage === 1"
            class="pager-btn"
            title="Primera página">
            <i class="fas fa-angle-double-left"></i>
          </button>

          <!-- Página anterior -->
          <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1"
            class="pager-btn">
            <i class="fas fa-angle-left"></i>
          </button>

          <!-- Página actual -->
          <span class="pager-current">
            {{ currentPage }}
          </span>

          <!-- Página siguiente -->
          <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage >= getTotalPages()"
            class="pager-btn">
            <i class="fas fa-angle-right"></i>
          </button>

          <!-- Última página -->
          <button (click)="onPageChange(getTotalPages())" [disabled]="currentPage >= getTotalPages()"
            class="pager-btn"
            title="Última página">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
