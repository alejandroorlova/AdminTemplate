<div
  class="sidebar-container sdb-container"
  [class.-translate-x-full]="!isOpen"
  [class.translate-x-0]="isOpen"
  [class.lg:relative]="isDesktop"
  [style.width]="isCollapsed ? '80px' : isDesktop ? '256px' : '280px'"
  [attr.data-open]="isOpen"
  [attr.data-desktop]="isDesktop"
  data-role="sidebar">

  <div class="flex items-center border-b border-white border-opacity-20 flex-shrink-0 transition-all duration-300 cursor-pointer group"
       [class]="isCollapsed ? 'h-16 px-4 justify-center' : (isDesktop ? 'h-20 px-6' : 'h-16 px-4')"
       (click)="handleLogoClick()">
    <div class="flex items-center" [class]="isCollapsed ? 'justify-center' : 'space-x-3'">
      <div class="bg-white bg-opacity-90 rounded-xl flex items-center justify-center shadow-lg transition-all duration-300 group-hover:bg-white group-hover:scale-105"
           [class]="isCollapsed ? 'w-10 h-10' : 'w-12 h-12'">
        <img *ngIf="logoConfig.image" [src]="logoConfig.image" [alt]="logoConfig.title" class="transition-all duration-300" [class]="isCollapsed ? 'w-6 h-6' : 'w-8 h-8'" />
        <i *ngIf="!logoConfig.image && logoConfig.icon" [class]="'fas fa-' + logoConfig.icon + ' text-iebem-primary transition-all duration-300'" [class.text-xl]="!isCollapsed" [class.text-lg]="isCollapsed"></i>
      </div>
      <div class="text-white transition-all duration-300 overflow-hidden" [class]="isCollapsed ? 'opacity-0 w-0' : 'opacity-100 w-auto'">
        <h1 class="text-xl font-heading font-bold tracking-wide whitespace-nowrap">{{ logoConfig.title }}</h1>
        <p *ngIf="logoConfig.subtitle" class="text-xs opacity-80 font-medium whitespace-nowrap">{{ logoConfig.subtitle }}</p>
      </div>
    </div>
    <button *ngIf="config.collapsible && !isCollapsed && isDesktop" type="button" class="ml-auto sdb-iconbtn" (click)="toggleCollapse(); $event.stopPropagation()" aria-label="Colapsar sidebar">
      <i class="fas fa-chevron-left text-sm"></i>
    </button>
    <button *ngIf="!isDesktop" type="button" class="ml-auto sdb-iconbtn" (click)="closeSidebar(); $event.stopPropagation()" aria-label="Cerrar sidebar">
      <i class="fas fa-times text-sm"></i>
    </button>
  </div>

  <div *ngIf="config.collapsible && isCollapsed && isDesktop" class="flex justify-center py-3 border-b border-white border-opacity-20">
    <button type="button" class="sdb-iconbtn" (click)="toggleCollapse()" aria-label="Expandir sidebar">
      <i class="fas fa-chevron-right text-sm"></i>
    </button>
  </div>

  <nav class="flex-1 overflow-y-auto" [class]="isCollapsed ? 'px-2' : 'px-4'" role="navigation" aria-label="Menu principal">
    <div class="py-6 space-y-2">
      <ng-container *ngFor="let item of config.items; trackBy: trackByItemId">
        <ng-container *ngIf="isItemVisible(item)">
          <div *ngIf="item.divider" class="my-4 border-t border-white border-opacity-20"></div>

          <div *ngIf="!item.divider" class="relative">
            <div class="relative group" [class.opacity-50]="item.disabled" [class.cursor-not-allowed]="item.disabled">
              <a *ngIf="item.route && !hasChildren(item)" [routerLink]="item.route" routerLinkActive="active-link" [routerLinkActiveOptions]="{ exact: false }" (click)="onNavigateClick($event, item)"
                 class="sdb-link group" [class]="getSidebarLinkClasses()" [title]="item.tooltip || item.label" [class.pointer-events-none]="item.disabled" [attr.aria-label]="item.label" [target]="item.target || '_self'">
                <div class="sdb-icon" [class]="isCollapsed ? 'w-8 h-8 mr-0' : 'w-10 h-10 mr-3'">
                  <i [class]="'fas fa-' + item.icon + ' text-lg'"></i>
                </div>
                <span class="font-medium flex-1 whitespace-nowrap overflow-hidden" [class.hidden]="isCollapsed">{{ item.label }}</span>
                <span *ngIf="item.badge && !isCollapsed" class="sdb-badge">{{ item.badge }}</span>
              </a>

              <button *ngIf="!item.route || hasChildren(item)" type="button" class="w-full sdb-link group disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"
                      [class]="getSidebarLinkClasses()" [class.bg-white]="isItemActive(item)" [class.bg-opacity-15]="isItemActive(item)" [class.text-white]="true"
                      [disabled]="item.disabled" [title]="item.tooltip || item.label" [attr.aria-label]="item.label" [attr.aria-expanded]="hasChildren(item) ? isExpanded(item.id) : null" [attr.aria-controls]="hasChildren(item) ? 'submenu-' + item.id : null" (click)="handleItemClick(item)">
                <div class="sdb-icon" [class]="isCollapsed ? 'w-8 h-8 mr-0' : 'w-10 h-10 mr-3'" [class.bg-white]="isItemActive(item)" [class.bg-opacity-25]="isItemActive(item)">
                  <i [class]="'fas fa-' + item.icon + ' text-lg'"></i>
                </div>
                <span class="font-medium flex-1 whitespace-nowrap overflow-hidden text-left" [class.hidden]="isCollapsed">{{ item.label }}</span>
                <span *ngIf="item.badge && !isCollapsed" class="sdb-badge">{{ item.badge }}</span>
                <i *ngIf="hasChildren(item) && !isCollapsed" class="fas fa-chevron-right text-xs ml-auto transition-transform duration-200" [class.rotate-90]="isExpanded(item.id)"></i>
              </button>

              <div *ngIf="isItemActive(item)" class="absolute right-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-white rounded-l-sm" aria-hidden="true"></div>
            </div>

            <div *ngIf="hasChildren(item) && (!isCollapsed || !isDesktop)" class="overflow-hidden transition-all duration-300 ease-in-out" [class]="isExpanded(item.id) ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'" [id]="'submenu-' + item.id" role="menu" [attr.aria-labelledby]="item.id + '-button'">
              <div class="pt-2 space-y-1">
                <ng-container *ngFor="let child of item.children; trackBy: trackByItemId">
                  <div *ngIf="isItemVisible(child)" class="relative">
                    <a *ngIf="child.route" [routerLink]="child.route" routerLinkActive="active-submenu-link" [routerLinkActiveOptions]="{ exact: false }" (click)="onNavigateClick($event, child)"
                       class="flex items-center space-x-3 px-4 py-3 mx-2 rounded-lg text-sm font-medium text-white text-opacity-90 hover:bg-white hover:bg-opacity-20 hover:text-white transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-20 active:scale-95"
                       [class.pointer-events-none]="child.disabled" [class.opacity-50]="child.disabled" [title]="child.tooltip || child.label" [attr.aria-label]="child.label" [target]="child.target || '_self'" role="menuitem">
                      <i [class]="'fas fa-' + child.icon + ' text-sm text-white text-opacity-80'"></i>
                      <span class="flex-1 text-white">{{ child.label }}</span>
                      <span *ngIf="child.badge" class="bg-white bg-opacity-25 text-white text-xs font-medium px-2 py-1 rounded-full">{{ child.badge }}</span>
                    </a>
                    <button *ngIf="!child.route" type="button" class="w-full flex items-center space-x-3 px-4 py-3 mx-2 rounded-lg text-sm font-medium text-white text-opacity-90 hover:bg-white hover:bg-opacity-20 hover:text-white transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-20 disabled:opacity-50 disabled:cursor-not-allowed"
                            [disabled]="child.disabled" [title]="child.tooltip || child.label" role="menuitem" (click)="handleItemClick(child)">
                      <i [class]="'fas fa-' + child.icon + ' text-sm text-white text-opacity-80'"></i>
                      <span class="flex-1 text-white">{{ child.label }}</span>
                      <span *ngIf="child.badge" class="bg-white bg-opacity-25 text-white text-xs font-medium px-2 py-1 rounded-full">{{ child.badge }}</span>
                    </button>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </nav>

  <div class="mt-auto p-4 text-white text-opacity-70 text-xs border-t border-white border-opacity-20">
    <div class="flex items-center justify-between">
      <span>{{ config.version || 'v1.0.0' }}</span>
      <span>{{ config.copyright || 'IEBEM Â© 2025' }}</span>
    </div>
  </div>
</div>
