<div *ngIf="isVisible"
     [class]="containerClasses"
     data-role="loader"
     [@fadeInOut]
     role="dialog"
     aria-modal="true"
     aria-labelledby="loader-message"
     (click)="$event.stopPropagation()">

  <!-- Simple Loader (solo cÃ­rculos) -->
  <div *ngIf="isSimpleLoader" class="flex items-center justify-center min-h-screen" [@scaleIn]>
    <div class="flex flex-col items-center gap-4">
      <div class="relative">
        <div class="w-16 h-16 border-4 border-iebem-primary border-t-transparent rounded-full animate-spin"></div>
        <div class="absolute top-2 left-2 w-12 h-12 border-4 border-iebem-secondary border-b-transparent rounded-full animate-spin" style="animation-direction: reverse; animation-duration: 0.8s;"></div>
        <div class="absolute top-4 left-4 w-8 h-8 border-4 border-iebem-gold border-l-transparent rounded-full animate-spin" style="animation-duration: 1.2s;"></div>
      </div>
      <div *ngIf="finalConfig.message" class="text-center">
        <p class="text-white font-medium text-lg">{{ finalConfig.message }}</p>
        <p *ngIf="finalConfig.submessage" class="text-white/80 text-sm mt-1">{{ finalConfig.submessage }}</p>
      </div>
    </div>
  </div>

  <!-- Loader Completo -->
  <div *ngIf="!isSimpleLoader" class="flex items-center justify-center min-h-screen p-4" [@scaleIn]>
    <div class="ldr-card">
      <div class="ldr-topbar"></div>
      <div class="ldr-body">
        <div class="relative mb-8 flex justify-center">
          <div class="relative">
            <div [class]="loaderSize + ' ldr-icon-bg'">
              <div class="absolute inset-0 rounded-full border-4 border-transparent border-t-white/30 animate-spin"></div>
              <i [class]="loaderIcon + ' text-white'" 
                 [class.text-lg]="finalConfig.size === 'sm'"
                 [class.text-xl]="finalConfig.size === 'md'"
                 [class.text-2xl]="finalConfig.size === 'lg'"></i>
            </div>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-iebem-gold rounded-full animate-bounce delay-75 opacity-80"></div>
            <div class="absolute -bottom-1 -left-1 w-2 h-2 bg-iebem-secondary rounded-full animate-pulse delay-150 opacity-60"></div>
          </div>
        </div>

        <div class="mb-6">
          <h3 id="loader-message" class="ldr-title">{{ finalConfig.message }}</h3>
          <p *ngIf="finalConfig.submessage" class="ldr-subtitle">{{ finalConfig.submessage }}</p>
        </div>

        <div *ngIf="finalConfig.showProgress" class="mb-6">
          <div class="ldr-progress-label">
            <span class="font-medium">Progreso</span>
            <span class="font-semibold">{{ finalConfig.progress }}%</span>
          </div>
          <div class="ldr-progress-track">
            <div class="ldr-progress-bar" [style.width.%]="finalConfig.progress">
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"></div>
            </div>
          </div>
        </div>

        <div *ngIf="finalConfig.showCancel" class="mb-4">
          <button (click)="onCancel()" class="ldr-cancel">
            <i class="fas fa-times"></i>
            <span>Cancelar</span>
          </button>
        </div>

        <div class="flex justify-center items-center space-x-1">
          <div class="w-2 h-2 bg-iebem-primary rounded-full animate-bounce"></div>
          <div class="w-2 h-2 bg-iebem-secondary rounded-full animate-bounce delay-75"></div>
          <div class="w-2 h-2 bg-iebem-gold rounded-full animate-bounce delay-150"></div>
        </div>
      </div>

      <div *ngIf="finalConfig.type === 'upload'" class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-6">
        <div class="flex items-end space-x-1">
          <div class="w-0.5 h-4 bg-iebem-primary rounded-full animate-pulse delay-0"></div>
          <div class="w-0.5 h-3 bg-iebem-secondary rounded-full animate-pulse delay-75"></div>
          <div class="w-0.5 h-5 bg-iebem-gold rounded-full animate-pulse delay-150"></div>
          <div class="w-0.5 h-2 bg-iebem-accent rounded-full animate-pulse delay-225"></div>
          <div class="w-0.5 h-4 bg-iebem-primary rounded-full animate-pulse delay-300"></div>
        </div>
      </div>

      <div *ngIf="finalConfig.type === 'download'" class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-6">
        <div class="bg-white/90 backdrop-blur-sm rounded-full px-3 py-1 shadow-md border border-gray-200 flex items-center space-x-2">
          <div class="w-1.5 h-1.5 bg-info rounded-full animate-ping"></div>
          <span class="text-xs text-gray-600 font-medium">Descargando</span>
        </div>
      </div>

      <div *ngIf="finalConfig.type === 'processing'" class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-8">
        <div class="bg-white/90 backdrop-blur-sm rounded-full px-3 py-1.5 shadow-md border border-gray-200 flex items-center space-x-2">
          <div class="flex space-x-1">
            <div class="w-1 h-1 bg-iebem-primary rounded-full animate-bounce delay-0"></div>
            <div class="w-1 h-1 bg-iebem-secondary rounded-full animate-bounce delay-100"></div>
            <div class="w-1 h-1 bg-iebem-gold rounded-full animate-bounce delay-200"></div>
          </div>
          <span class="text-xs text-gray-600 font-medium">Procesando</span>
        </div>
      </div>
    </div>
  </div>

  <div class="absolute inset-0 opacity-10 pointer-events-none overflow-hidden">
    <div class="absolute top-1/4 left-1/4 w-32 h-32 bg-white rounded-full mix-blend-overlay filter blur-3xl animate-blob"></div>
    <div class="absolute top-1/3 right-1/4 w-32 h-32 bg-white rounded-full mix-blend-overlay filter blur-3xl animate-blob animation-delay-2000"></div>
  </div>
</div>

